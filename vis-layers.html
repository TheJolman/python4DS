

<!DOCTYPE html>


<html >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>13. Layers &#8212; Python for Data Science</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-LXJC37BJVX"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-LXJC37BJVX');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'vis-layers';</script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="14. Exploratory Data Analysis" href="exploratory-data-analysis.html" />
    <link rel="prev" title="12. Visualisation" href="visualise.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="None"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="welcome.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="welcome.html">
                    Welcome
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">First Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="prerequisites.html">Prerequisites</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Quick Start</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="whole-game.html">1. Whole Game</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-visualise.html">2. Data Visualisation</a></li>

<li class="toctree-l1"><a class="reference internal" href="workflow-basics.html">4. Workflow: Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-transform.html">5. Data Transformation</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow-style.html">6. Workflow: Style</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-tidy.html">7. Tidy Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow-writing-code.html">8. Workflow: Writing Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-import.html">9. Data Import</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow-packages-and-environments.html">10. Workflow: Packages and Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow-help.html">11. Postscript: Getting Further Help</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Visualise</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="visualise.html">12. Visualisation</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">13. Layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="exploratory-data-analysis.html">14. Exploratory Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="communicate-plots.html">15. Graphics for Communication</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Transform</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="boolean-data.html">16. Boolean Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="numbers.html">17. Numbers</a></li>
<li class="toctree-l1"><a class="reference internal" href="strings.html">18. Strings and Text</a></li>
<li class="toctree-l1"><a class="reference internal" href="regex.html">19. Regular Expressions, aka regex</a></li>
<li class="toctree-l1"><a class="reference internal" href="categorical-data.html">20. Categorical Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="dates-and-times.html">21. Dates and Times</a></li>
<li class="toctree-l1"><a class="reference internal" href="missing-values.html">22. Missing Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="joins.html">23. Joins</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Import</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="spreadsheets.html">24. Spreadsheets</a></li>
<li class="toctree-l1"><a class="reference internal" href="databases.html">25. Databases</a></li>
<li class="toctree-l1"><a class="reference internal" href="rectangling.html">26. Nested Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="webscraping-and-apis.html">27. Webscraping and APIs</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Programme</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="functions.html">28. Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="iteration.html">29. Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="command-line.html">30. The Command Line</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Communicate</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="markdown.html">31. Markdown</a></li>
<li class="toctree-l1"><a class="reference internal" href="quarto.html">32. Quarto</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="zreferences.html">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/aeturrell/python4DS/main?urlpath=lab/tree/vis-layers.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/aeturrell/python4DS/blob/main/vis-layers.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/aeturrell/python4DS" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/aeturrell/python4DS/issues/new?title=Issue%20on%20page%20%2Fvis-layers.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/vis-layers.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Layers</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">13.1. Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">13.1.1. Prerequisites</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aesthetic-mappings">13.2. Aesthetic mappings</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#geometric-objects">13.3. Geometric objects</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">13.3.1. Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#facets">13.4. Facets</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">13.4.1. Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-transformations">13.5. Statistical transformations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#position-adjustments">13.6. Position adjustments</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">13.6.1. Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-layered-grammar-of-graphics">13.7. The layered grammar of graphics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">13.8. Summary</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="layers">
<span id="vis-layers"></span><h1><span class="section-number">13. </span>Layers<a class="headerlink" href="#layers" title="Permalink to this headline">#</a></h1>
<section id="introduction">
<h2><span class="section-number">13.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p>In the previous chapters, you’ve learned much more than just how to make scatterplots, bar charts, and boxplots.
You learned a foundation that you can use to make <em>any</em> type of plot with <strong>lets-plot</strong>.</p>
<p>In this chapter, you’ll expand on that foundation as you learn about the layered grammar of graphics.
We’ll start with a deeper dive into aesthetic mappings, geometric objects, and facets.
Then, you will learn about statistical transformations <strong>lets-plot</strong> makes under the hood when creating a plot.
These transformations are used to calculate new values to plot, such as the heights of bars in a bar plot or medians in a box plot.
You will also learn about position adjustments, which modify how geoms are displayed in your plots.
Finally, we’ll briefly introduce coordinate systems.</p>
<p>We will not cover every single function and option for each of these layers, but we will walk you through the most important and commonly used functionality provided by <strong>lets-plot</strong>.</p>
<section id="prerequisites">
<h3><span class="section-number">13.1.1. </span>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">#</a></h3>
<p>You will need to install the <strong>letsplot</strong> package for this chapter, as well as <strong>pandas</strong>.</p>
<p>In your Python session, import the libraries we’ll be using:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">lets_plot</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">lets_plot.geo_data</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">lets_plot.mapping</span> <span class="kn">import</span> <span class="n">as_discrete</span>

<span class="n">LetsPlot</span><span class="o">.</span><span class="n">setup_html</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="nn">Input In [1],</span> in <span class="ni">&lt;cell line: 3&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">from</span> <span class="nn">lets_plot</span> <span class="kn">import</span> <span class="o">*</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="kn">from</span> <span class="nn">lets_plot.geo_data</span> <span class="kn">import</span> <span class="o">*</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="kn">from</span> <span class="nn">lets_plot.mapping</span> <span class="kn">import</span> <span class="n">as_discrete</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">LetsPlot</span><span class="o">.</span><span class="n">setup_html</span><span class="p">()</span>

<span class="n">File</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">py4ds2e</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.10</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">lets_plot</span><span class="o">/</span><span class="n">geo_data</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>     <span class="kn">import</span> <span class="nn">geopandas</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<span class="ne">----&gt; </span><span class="mi">4</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;geopandas is required for using the geo_data package&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="kn">from</span> <span class="nn">.core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="kn">from</span> <span class="nn">.geocoder</span> <span class="kn">import</span> <span class="o">*</span>

<span class="ne">ValueError</span>: geopandas is required for using the geo_data package
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="aesthetic-mappings">
<h2><span class="section-number">13.2. </span>Aesthetic mappings<a class="headerlink" href="#aesthetic-mappings" title="Permalink to this headline">#</a></h2>
<blockquote>
<div><p>“The greatest value of a picture is when it forces us to notice what we never expected to see.” — John Tukey</p>
</div></blockquote>
<p>We’re going to use the <code class="docutils literal notranslate"><span class="pre">mpg</span></code> dataset for this section, so let’s download it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mpg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">&quot;https://vincentarelbundock.github.io/Rdatasets/csv/ggplot2/mpg.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>

<span class="n">mpg</span> <span class="o">=</span> <span class="n">mpg</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;manufacturer&quot;</span><span class="p">:</span> <span class="s2">&quot;category&quot;</span><span class="p">,</span>
        <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;category&quot;</span><span class="p">,</span>
        <span class="s2">&quot;displ&quot;</span><span class="p">:</span> <span class="s2">&quot;double&quot;</span><span class="p">,</span>
        <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="s2">&quot;int64&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cyl&quot;</span><span class="p">:</span> <span class="s2">&quot;int64&quot;</span><span class="p">,</span>
        <span class="s2">&quot;trans&quot;</span><span class="p">:</span> <span class="s2">&quot;category&quot;</span><span class="p">,</span>
        <span class="s2">&quot;drv&quot;</span><span class="p">:</span> <span class="s2">&quot;category&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cty&quot;</span><span class="p">:</span> <span class="s2">&quot;double&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hwy&quot;</span><span class="p">:</span> <span class="s2">&quot;double&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fl&quot;</span><span class="p">:</span> <span class="s2">&quot;category&quot;</span><span class="p">,</span>
        <span class="s2">&quot;class&quot;</span><span class="p">:</span> <span class="s2">&quot;category&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">mpg</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Among the variables in <code class="docutils literal notranslate"><span class="pre">mpg</span></code> are:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">displ</span></code>: A car’s engine size, in liters.
A numerical variable.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hwy</span></code>: A car’s fuel efficiency on the highway, in miles per gallon (mpg).
A car with a low fuel efficiency consumes more fuel than a car with a high fuel efficiency when they travel the same distance.
A numerical variable.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">class</span></code>: Type of car.
A categorical variable.</p></li>
</ol>
<p>Let’s start by visualising the relationship between <code class="docutils literal notranslate"><span class="pre">displ</span></code> and <code class="docutils literal notranslate"><span class="pre">hwy</span></code> for various <code class="docutils literal notranslate"><span class="pre">class</span></code>es of cars.
We can do this with a scatterplot where the numerical variables are mapped to the <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> aesthetics and the categorical variable is mapped to an aesthetic like <code class="docutils literal notranslate"><span class="pre">color</span></code> or <code class="docutils literal notranslate"><span class="pre">shape</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;hwy&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;class&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;hwy&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="s2">&quot;class&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>Similarly, we can map <code class="docutils literal notranslate"><span class="pre">class</span></code> to <code class="docutils literal notranslate"><span class="pre">size</span></code> or <code class="docutils literal notranslate"><span class="pre">alpha</span></code> aesthetics as well, which control the shape and the transparency of the points, respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;hwy&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;class&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;hwy&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="s2">&quot;class&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>While we are able to do it, mapping an unordered discrete (categorical) variable (<code class="docutils literal notranslate"><span class="pre">class</span></code>) to an ordered aesthetic variable (<code class="docutils literal notranslate"><span class="pre">size</span></code> or <code class="docutils literal notranslate"><span class="pre">alpha</span></code>) is generally not a good idea because it implies a ranking that does not in fact exist.</p>
<p>Once you map an aesthetic, <strong>lets-plot</strong> takes care of the rest.
It selects a reasonable scale to use with the aesthetic, and it constructs a legend that explains the mapping between levels and values.
For x and y aesthetics, <strong>lets-plot</strong> does not create a legend, but it creates an axis line with tick marks and a label.
The axis line provides the same information as a legend; it explains the mapping between locations and values.</p>
<p>You can also set the visual properties of your geom manually as an argument of your geom function (<em>outside</em> of <code class="docutils literal notranslate"><span class="pre">aes()</span></code>) instead of relying on a variable mapping to determine the appearance.
For example, we can make all of the points in our plot blue:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Here, the colour doesn’t convey information about a variable, but only changes the appearance of the plot.
You’ll need to pick a value that makes sense for that aesthetic:</p>
<ul class="simple">
<li><p>The name of a color as a character string, e.g., <code class="docutils literal notranslate"><span class="pre">color</span> <span class="pre">=</span> <span class="pre">&quot;blue&quot;</span></code></p></li>
<li><p>The size of a point in mm, e.g., <code class="docutils literal notranslate"><span class="pre">size</span> <span class="pre">=</span> <span class="pre">1</span></code></p></li>
<li><p>The shape of a point as a number, e.g, <code class="docutils literal notranslate"><span class="pre">shape</span> <span class="pre">=</span> <span class="pre">1</span></code>.</p></li>
</ul>
<p>Try changing the above plot but, instead of specifying colour, try specifying the shape aesthetic. What do you get with shape set to 1, 2, or 3?</p>
<p>So far we have discussed aesthetics that we can map or set in a scatterplot, when using a point geom.</p>
<p>The specific aesthetics you can use for a plot depend on the geom you use to represent the data.
In the next section we dive deeper into geoms.</p>
<ol class="arabic">
<li><p>Create a scatterplot of <code class="docutils literal notranslate"><span class="pre">hwy</span></code> vs. <code class="docutils literal notranslate"><span class="pre">displ</span></code> where the points are pink filled in triangles.</p></li>
<li><p>Why does the following code not result in a plot with blue points?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> 
  <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;hwy&quot;</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span><span class="p">))</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>What does the <code class="docutils literal notranslate"><span class="pre">stroke</span></code> aesthetic do?
What shapes does it work with?
(Hint: use <code class="docutils literal notranslate"><span class="pre">stroke</span></code> in the global aesthetic and <code class="docutils literal notranslate"><span class="pre">shape</span></code> in <code class="docutils literal notranslate"><span class="pre">geom_point</span></code>)</p></li>
<li><p>Try changing the last plot from above but, instead of specifying colour, try specifying the shape aesthetic. What do you get with shape set to 1, 2, or 3?</p></li>
</ol>
</section>
<section id="geometric-objects">
<h2><span class="section-number">13.3. </span>Geometric objects<a class="headerlink" href="#geometric-objects" title="Permalink to this headline">#</a></h2>
<p>How are these two plots similar?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;loess&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Both plots contain the same x variable, the same y variable, and both describe the same data.
But the plots are not identical.
Each plot uses a different geometric object, geom, to represent the data.
The plot on the left uses the point geom, and the plot on the right uses the smooth geom, a smooth line fitted to the data.</p>
<p>To change the geom in your plot, change the geom function that you add to <code class="docutils literal notranslate"><span class="pre">ggplot()</span></code>.</p>
<p>Every geom function in <strong>lets-plot</strong> takes a <code class="docutils literal notranslate"><span class="pre">mapping</span></code> argument, either defined locally in the geom layer or globally in the <code class="docutils literal notranslate"><span class="pre">ggplot()</span></code> layer.
However, not every aesthetic works with every geom.
You could set the shape of a point, but you couldn’t set the “shape” of a line.
If you try, <strong>lets-plot</strong> will silently ignore that aesthetic mapping.
On the other hand, you <em>could</em> set the linetype of a line.
<code class="docutils literal notranslate"><span class="pre">geom_smooth()</span></code> will draw a different line, with a different linetype, for each unique value of the variable that you map to linetype.</p>
<p>Let’s take a look:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;hwy&quot;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="s2">&quot;drv&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;loess&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;hwy&quot;</span><span class="p">,</span> <span class="n">linetype</span><span class="o">=</span><span class="s2">&quot;drv&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;loess&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Here, <code class="docutils literal notranslate"><span class="pre">geom_smooth()</span></code> separates the cars into three lines based on their <code class="docutils literal notranslate"><span class="pre">drv</span></code> value, which describes a car’s drive train.
One line describes all of the points that have a <code class="docutils literal notranslate"><span class="pre">4</span></code> value, one line describes all of the points that have an <code class="docutils literal notranslate"><span class="pre">f</span></code> value, and one line describes all of the points that have an <code class="docutils literal notranslate"><span class="pre">r</span></code> value.
Here, <code class="docutils literal notranslate"><span class="pre">4</span></code> stands for four-wheel drive, <code class="docutils literal notranslate"><span class="pre">f</span></code> for front-wheel drive, and <code class="docutils literal notranslate"><span class="pre">r</span></code> for rear-wheel drive.</p>
<p>If this is too confusing, we can make it clearer by overlaying the lines on top of the raw data and then coloring everything according to <code class="docutils literal notranslate"><span class="pre">drv</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;hwy&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;drv&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">linetype</span><span class="o">=</span><span class="s2">&quot;drv&quot;</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;loess&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Notice that this plot contains two geoms in the same graph.</p>
<p>Many geoms, like <code class="docutils literal notranslate"><span class="pre">geom_smooth()</span></code>, use a single geometric object to display multiple rows of data.
For these geoms, you can set the <code class="docutils literal notranslate"><span class="pre">group</span></code> aesthetic to a categorical variable to draw multiple objects.
<strong>lets-plot</strong> will draw a separate object for each unique value of the grouping variable.
In practice, <strong>lets-plot</strong> will automatically group the data for these geoms whenever you map an aesthetic to a discrete variable.
It is convenient to rely on this feature because the <code class="docutils literal notranslate"><span class="pre">group</span></code> aesthetic by itself does not add a legend or distinguishing features to the geoms.</p>
<p>Note that if you place mappings in a geom function, <strong>lets-plot</strong> will treat them as local mappings for the layer.
It will use these mappings to extend or overwrite the global mappings <em>for that layer only</em>.
This makes it possible to display different aesthetics in different layers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;class&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>You can use the same idea to specify different data for each layer.
Here, we use red points as well as open circles to highlight two-seater cars.
The local data argument in <code class="docutils literal notranslate"><span class="pre">geom_point()</span></code> overrides the global data argument in <code class="docutils literal notranslate"><span class="pre">ggplot()</span></code> for that layer only.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;hwy&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mpg</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;2seater&quot;</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">mpg</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mpg</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;2seater&quot;</span><span class="p">,</span> <span class="p">:],</span> <span class="n">shape</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Geoms are the fundamental building blocks of <strong>lets-plot</strong>.
You can completely transform the look of your plot by changing its geom, and different geoms can reveal different features of your data.</p>
<p><strong>lets-plot</strong> provides over 40 geoms but these don’t cover all possible plots one could make. You can find an overview at the relevant part of the <a class="reference external" href="https://lets-plot.org/pages/api.html#geometries"><strong>lets-plot</strong> documentation</a>.</p>
<p>If you need a geom that is not included, you have three main options:</p>
<ol class="arabic simple">
<li><p>Look for packages that extend <strong>lets-plot</strong> and that do what you need</p></li>
<li><p>Raise an issue on the <a class="reference external" href="https://github.com/JetBrains/lets-plot"><strong>lets-plot</strong> Github page</a> requesting it as a new feature—but bear in mind that it might not be a priority for the maintainers, and there’s no guarantee that they’ll add it, depending on how useful it is for others and how easy it is to implemet.</p></li>
<li><p>Turn to an imperative plotting package that gives you fine-grained control so you can build your own chart from the ground up—<a class="reference external" href="https://matplotlib.org/"><strong>matplotlib</strong></a> is absolutely excellent for this.</p></li>
</ol>
<section id="exercises">
<h3><span class="section-number">13.3.1. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">#</a></h3>
<ol class="arabic">
<li><p>What geom would you use to draw a line chart?
A boxplot?
A histogram?
An area chart?</p></li>
<li><p>What effect would running the previous example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
<span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;hwy&quot;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="s2">&quot;class&quot;</span><span class="p">))</span> <span class="o">+</span>
  <span class="n">geom_point</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
<p>with the keyword argument <code class="docutils literal notranslate"><span class="pre">show_legend=False</span></code> have on the chart generated by this code?</p>
</li>
<li><p>What does the <code class="docutils literal notranslate"><span class="pre">se</span></code> argument to <code class="docutils literal notranslate"><span class="pre">geom_smooth()</span></code> do?</p></li>
<li><p>Recreate the Python code necessary to generate the following graph.</p></li>
</ol>
</section>
</section>
<section id="facets">
<h2><span class="section-number">13.4. </span>Facets<a class="headerlink" href="#facets" title="Permalink to this headline">#</a></h2>
<p>In <a class="reference internal" href="data-visualise.html#data-visualise"><span class="std std-ref">Data Visualisation</span></a>, you learned about faceting with <code class="docutils literal notranslate"><span class="pre">facet_wrap()</span></code>, which splits a plot into subplots that each display one subset of the data based on a categorical variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span> <span class="o">+</span> <span class="n">facet_wrap</span><span class="p">(</span><span class="s2">&quot;cyl&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>To facet your plot with the combination of two variables, switch from <code class="docutils literal notranslate"><span class="pre">facet_wrap()</span></code> to <code class="docutils literal notranslate"><span class="pre">facet_grid()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span> <span class="o">+</span> <span class="n">facet_grid</span><span class="p">(</span><span class="s2">&quot;drv&quot;</span><span class="p">,</span> <span class="s2">&quot;cyl&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>By default each of the facets share the same scale and range for x and y axes.
This is useful when you want to compare data across facets, and is the recommended default, but it can be limiting when you want to visualise the relationship within each facet better.
Setting the <code class="docutils literal notranslate"><span class="pre">scales</span></code> argument in a faceting function to <code class="docutils literal notranslate"><span class="pre">&quot;free&quot;</span></code> will allow for different axis scales across both rows and columns, <code class="docutils literal notranslate"><span class="pre">&quot;free_x&quot;</span></code> will allow for different scales across rows, and <code class="docutils literal notranslate"><span class="pre">&quot;free_y&quot;</span></code> will allow for different scales across columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;hwy&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">geom_point</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">facet_grid</span><span class="p">(</span><span class="s2">&quot;drv&quot;</span><span class="p">,</span> <span class="s2">&quot;cyl&quot;</span><span class="p">,</span> <span class="n">scales</span><span class="o">=</span><span class="s2">&quot;free_y&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">facet_wrap</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h3><span class="section-number">13.4.1. </span>Exercises<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h3>
<ol class="arabic">
<li><p>What happens if you facet on a continuous variable?</p></li>
<li><p>What do the empty cells in plot with <code class="docutils literal notranslate"><span class="pre">facet_grid(&quot;drv&quot;,</span> <span class="pre">&quot;cyl&quot;)</span></code> mean?
Run the following code.
How do they relate to the resulting plot?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="p">(</span>
      <span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> 
  <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;drv&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;cyl&quot;</span><span class="p">))</span>
    <span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>What plots does the following code make?
What does omitting the second variable do?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
  <span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> 
  <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span>
  <span class="n">facet_grid</span><span class="p">(</span><span class="s2">&quot;drv&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span>
  <span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> 
  <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">displ</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span>
  <span class="n">facet_grid</span><span class="p">(</span><span class="s2">&quot;cyl&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Take the first faceted plot in this section:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> 
      <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span> 
      <span class="n">facet_wrap</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="n">nrow</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>What are the advantages to using faceting instead of the color aesthetic?
What are the disadvantages?
How might the balance change if you had a larger dataset?</p>
</li>
<li><p>Read <code class="docutils literal notranslate"><span class="pre">help(facet_wrap)</span></code> or hover your mouse over <code class="docutils literal notranslate"><span class="pre">facet_wrap</span></code> in Visual Studio Code.
What does <code class="docutils literal notranslate"><span class="pre">nrow</span></code> do?
What does <code class="docutils literal notranslate"><span class="pre">ncol</span></code> do?
What other options control the layout of the individual panels?
Why doesn’t <code class="docutils literal notranslate"><span class="pre">facet_grid()</span></code> have <code class="docutils literal notranslate"><span class="pre">nrow</span></code> and <code class="docutils literal notranslate"><span class="pre">ncol</span></code> arguments?</p></li>
<li><p>Recreate the following plot using <code class="docutils literal notranslate"><span class="pre">facet_wrap()</span></code> instead of <code class="docutils literal notranslate"><span class="pre">facet_grid()</span></code>.
How do the positions of the facet labels change?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">)</span> <span class="o">+</span> 
      <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span>
      <span class="n">facet_grid</span><span class="p">(</span><span class="s2">&quot;drv&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
<section id="statistical-transformations">
<h2><span class="section-number">13.5. </span>Statistical transformations<a class="headerlink" href="#statistical-transformations" title="Permalink to this headline">#</a></h2>
<p>Consider a basic bar chart, drawn with <code class="docutils literal notranslate"><span class="pre">geom_bar()</span></code> or <code class="docutils literal notranslate"><span class="pre">geom_col()</span></code>.
The following chart displays the total number of diamonds in the <code class="docutils literal notranslate"><span class="pre">diamonds</span></code> dataset, grouped by <code class="docutils literal notranslate"><span class="pre">cut</span></code>.
The <code class="docutils literal notranslate"><span class="pre">diamonds</span></code> dataset  contains information on ~54,000 diamonds, including the <code class="docutils literal notranslate"><span class="pre">price</span></code>, <code class="docutils literal notranslate"><span class="pre">carat</span></code>, <code class="docutils literal notranslate"><span class="pre">color</span></code>, <code class="docutils literal notranslate"><span class="pre">clarity</span></code>, and <code class="docutils literal notranslate"><span class="pre">cut</span></code> of each diamond. We’ll load it in a moment.
The chart shows that more diamonds are available with high quality cuts than with low quality cuts.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diamonds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">&quot;https://vincentarelbundock.github.io/Rdatasets/csv/ggplot2/diamonds.csv&quot;</span><span class="p">,</span>
    <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">diamonds_cut_order</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Fair&quot;</span><span class="p">,</span> <span class="s2">&quot;Good&quot;</span><span class="p">,</span> <span class="s2">&quot;Very Good&quot;</span><span class="p">,</span> <span class="s2">&quot;Premium&quot;</span><span class="p">,</span> <span class="s2">&quot;Ideal&quot;</span><span class="p">]</span>
<span class="n">diamonds</span><span class="p">[</span><span class="s2">&quot;cut&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">diamonds</span><span class="p">[</span><span class="s2">&quot;cut&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="n">diamonds_cut_order</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">diamonds</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">diamonds</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;cut&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_bar</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>On the x-axis, the chart displays <code class="docutils literal notranslate"><span class="pre">cut</span></code>, a variable from <code class="docutils literal notranslate"><span class="pre">diamonds</span></code>.
On the y-axis, it displays count, but count is not a variable in <code class="docutils literal notranslate"><span class="pre">diamonds</span></code>!
Where does count come from?
Many graphs, like scatterplots, plot the raw values of your dataset.
Other graphs, like bar charts, calculate new values to plot:</p>
<ul class="simple">
<li><p>Bar charts, histograms, and frequency polygons bin your data and then plot bin counts, the number of points that fall in each bin.</p></li>
<li><p>Smoothers fit a model to your data and then plot predictions from the model.</p></li>
<li><p>Boxplots compute the five-number summary of the distribution and then display that summary as a specially formatted box.</p></li>
</ul>
<p>The algorithm used to calculate new values for a graph is called a <strong>stat</strong>, short for statistical transformation.
The figure below shows how this process works with <code class="docutils literal notranslate"><span class="pre">geom_bar()</span></code>.</p>
<p><img alt="" src="https://r4ds.hadley.nz/images/visualization-stat-bar.png" /></p>
<p>You can learn which stat a geom uses by inspecting the default value for the <code class="docutils literal notranslate"><span class="pre">stat</span></code> argument.
For example, <code class="docutils literal notranslate"><span class="pre">help(geom_bar)</span></code> (or hovering your mouse over the function written in code) shows that the default value for <code class="docutils literal notranslate"><span class="pre">stat</span></code> is “count”, which means that <code class="docutils literal notranslate"><span class="pre">geom_bar()</span></code> uses counts of the number of occurrences.</p>
<p>Every geom has a default stat; and every stat has a default geom.
This means that you can typically use geoms without worrying about the underlying statistical transformation.
However, there are some reasons why you might need to use a stat explicitly; for example, you might want to override the default stat. In the code below, we change the stat of <code class="docutils literal notranslate"><span class="pre">geom_bar()</span></code> from count (the default) to identity. This lets us map the height of the bars to the raw values of a y variable.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span>
        <span class="n">diamonds</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="s2">&quot;cut&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;counts&quot;</span><span class="p">),</span>
        <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;cut&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;counts&quot;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="o">=</span><span class="s2">&quot;identity&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="position-adjustments">
<h2><span class="section-number">13.6. </span>Position adjustments<a class="headerlink" href="#position-adjustments" title="Permalink to this headline">#</a></h2>
<p>There’s one more piece of magic associated with bar charts.
You can colour a bar chart using either the <code class="docutils literal notranslate"><span class="pre">color</span></code> aesthetic, or, more usefully, the <code class="docutils literal notranslate"><span class="pre">fill</span></code> aesthetic:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;drv&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;drv&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_bar</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;drv&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;drv&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_bar</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>Note what happens if you map the fill aesthetic to another variable, like <code class="docutils literal notranslate"><span class="pre">class</span></code>: the bars are automatically stacked.
Each colored rectangle represents a combination of <code class="docutils literal notranslate"><span class="pre">drv</span></code> and <code class="docutils literal notranslate"><span class="pre">class</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;drv&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;class&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_bar</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>The stacking is performed automatically using the <strong>position adjustment</strong> specified by the <code class="docutils literal notranslate"><span class="pre">position</span></code> argument.
If you don’t want a stacked bar chart, you can use one of three other options: <code class="docutils literal notranslate"><span class="pre">&quot;identity&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;dodge&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;fill&quot;</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">position</span> <span class="pre">=</span> <span class="pre">&quot;identity&quot;</span></code> will place each object exactly where it falls in the context of the graph.
This is not very useful for bars, because it overlaps them.
To see that overlapping we usually need to make the bars slightly transparent by setting <code class="docutils literal notranslate"><span class="pre">alpha</span></code> to a small value.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;drv&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;class&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_bar</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;identity&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>The identity position adjustment is more useful for 2d geoms, like points, where it is the default.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">position</span> <span class="pre">=</span> <span class="pre">&quot;fill&quot;</span></code> works like stacking, but makes each set of stacked bars the same height.
This makes it easier to compare proportions across groups.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;drv&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;class&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_bar</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="s2">&quot;fill&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">position</span> <span class="pre">=</span> <span class="pre">&quot;dodge&quot;</span></code> places overlapping objects directly <em>beside</em> one another.
This makes it easier to compare individual values.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;drv&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;class&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_bar</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="s2">&quot;dodge&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>There’s one other type of adjustment that’s not useful for bar charts, but can be very useful for scatterplots.
Recall our first scatterplot.
Did you notice that the plot displays only some of the points (even though there are 234 observations in the dataset)?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<p>The underlying values of <code class="docutils literal notranslate"><span class="pre">hwy</span></code> and <code class="docutils literal notranslate"><span class="pre">displ</span></code> are rounded so the points appear on a grid and many points overlap each other.
This problem is known as <strong>overplotting</strong>.
This arrangement makes it difficult to see the distribution of the data.
Are the data points spread equally throughout the graph, or is there one special combination of <code class="docutils literal notranslate"><span class="pre">hwy</span></code> and <code class="docutils literal notranslate"><span class="pre">displ</span></code> that contains 109 values?</p>
<p>You can avoid this gridding by setting the position adjustment to “jitter”.
<code class="docutils literal notranslate"><span class="pre">position</span> <span class="pre">=</span> <span class="pre">&quot;jitter&quot;</span></code> adds a small amount of random noise to each point.
This spreads the points out because no two points are likely to receive the same amount of random noise.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="s2">&quot;jitter&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Adding randomness seems like a strange way to improve your plot, but while it makes your graph less accurate at small scales, it makes your graph <em>more</em> revealing at large scales.
Because this is such a useful operation, ggplot2 comes with a shorthand for <code class="docutils literal notranslate"><span class="pre">geom_point(position</span> <span class="pre">=</span> <span class="pre">&quot;jitter&quot;)</span></code>: <code class="docutils literal notranslate"><span class="pre">geom_jitter()</span></code>.</p>
<p>Of course, a more sophisticated way of dealing with overplotting is via a binscatter plot, which is available in the <a class="reference external" href="https://nppackages.github.io/binsreg/"><strong>binsreg</strong></a> package.</p>
<p>To learn more about position adjustment, take a look at the <a class="reference external" href="https://lets-plot.org/">documentation</a>.</p>
<section id="id2">
<h3><span class="section-number">13.6.1. </span>Exercises<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h3>
<ol class="arabic simple">
<li><p>What is the problem with the following plot?
How could you improve it?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;cty&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_point</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<ol class="arabic" start="2">
<li><p>What, if anything, is the difference between the two plots?
Why?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span>
      <span class="n">geom_point</span><span class="p">()</span>
<span class="p">)</span>
<span class="p">(</span>
    <span class="n">ggplot</span><span class="p">(</span><span class="n">mpg</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="s2">&quot;displ&quot;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s2">&quot;hwy&quot;</span><span class="p">))</span> <span class="o">+</span>
      <span class="n">geom_point</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="s2">&quot;identity&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<ol class="arabic simple" start="3">
<li><p>What parameters to <code class="docutils literal notranslate"><span class="pre">geom_jitter()</span></code> control the amount of jittering?</p></li>
<li><p>What’s the default position adjustment for <code class="docutils literal notranslate"><span class="pre">geom_boxplot()</span></code>?
Create a visualisation of the <code class="docutils literal notranslate"><span class="pre">mpg</span></code> dataset that demonstrates it.</p></li>
</ol>
</section>
</section>
<section id="the-layered-grammar-of-graphics">
<h2><span class="section-number">13.7. </span>The layered grammar of graphics<a class="headerlink" href="#the-layered-grammar-of-graphics" title="Permalink to this headline">#</a></h2>
<p>We can expand on the graphing template you learned already by adding position adjustments, stats, coordinate systems, and faceting:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">DATA</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">+</span> 
  <span class="o">&lt;</span><span class="n">GEOM_FUNCTION</span><span class="o">&gt;</span><span class="p">(</span>
     <span class="n">mapping</span> <span class="o">=</span> <span class="n">aes</span><span class="p">(</span><span class="o">&lt;</span><span class="n">MAPPINGS</span><span class="o">&gt;</span><span class="p">),</span>
     <span class="n">stat</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">STAT</span><span class="o">&gt;</span><span class="p">,</span> 
     <span class="n">position</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">POSITION</span><span class="o">&gt;</span>
  <span class="p">)</span> <span class="o">+</span>
  <span class="o">&lt;</span><span class="n">FACET_FUNCTION</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Our new template takes six parameters, the bracketed words that appear in the template.
In practice, you rarely need to supply all seven parameters to make a graph because **lets-plot88 will provide useful defaults for everything except the data, the mappings, and the geom function.</p>
<p>The six parameters in the template compose the grammar of graphics, a formal system for building plots.
The grammar of graphics is based on the insight that you can uniquely describe <em>any</em> plot as a combination of a dataset, a geom, a set of mappings, a stat, a position adjustment, a coordinate system, a faceting scheme, and a theme.</p>
<p>To see how this works, consider how you could build a basic plot from scratch: you could start with a dataset and then transform it into the information that you want to display (with a stat).
Next, you could choose a geometric object to represent each observation in the transformed data.
You could then use the aesthetic properties of the geoms to represent variables in the data.
You would map the values of each variable to the levels of an aesthetic.
These steps are illustrated in the figure below.</p>
<p><img alt="" src="https://r4ds.hadley.nz/images/visualization-grammar.png" /></p>
<p>At this point, you would have a complete graph, but you could further adjust the positions of the geoms within the coordinate system (a position adjustment) or split the graph into subplots (faceting).
You could also extend the plot by adding one or more additional layers, where each additional layer uses a dataset, a geom, a set of mappings, a stat, and a position adjustment.</p>
<p>You could use this method to create a lot of plots that you can imagine.</p>
</section>
<section id="summary">
<h2><span class="section-number">13.8. </span>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">#</a></h2>
<p>In this chapter you learned about the layered grammar of graphics starting with aesthetics and geometries to build a simple plot, facets for splitting the plot into subsets, statistics for understanding how geoms are calculated, position adjustments for controlling the fine details of position when geoms might otherwise overlap, and coordinate systems which allow you to fundamentally change what <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> mean.</p>
<p>The most useful further resource on <strong>lets-plot</strong> is the documentation, which you <a class="reference external" href="https://lets-plot.org/">can find here</a>.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="visualise.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">12. </span>Visualisation</p>
      </div>
    </a>
    <a class="right-next"
       href="exploratory-data-analysis.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">14. </span>Exploratory Data Analysis</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">13.1. Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">13.1.1. Prerequisites</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aesthetic-mappings">13.2. Aesthetic mappings</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#geometric-objects">13.3. Geometric objects</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">13.3.1. Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#facets">13.4. Facets</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">13.4.1. Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-transformations">13.5. Statistical transformations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#position-adjustments">13.6. Position adjustments</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">13.6.1. Exercises</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-layered-grammar-of-graphics">13.7. The layered grammar of graphics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">13.8. Summary</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Py4DS Community
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>